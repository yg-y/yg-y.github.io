# 前言

在互联网发展迅猛的今天，MySQL作为一款关系型数据库无疑是使用范围最广的数据库操作系统之一，而作为一名开发人员，或多或少都需要了解一些数据库知识。

后续会以 MySQL5.7 版本进行演示，截止目前，MySQL已经更新到 8.0 版本。

本文会作为一个系列更新下去，包括但不仅限于以下几个方面：

- [MySQL 基本架构及日志文件](https://yg-y.github.io/content.html?id=15)
- [MySQL 数据库日志文件之 Bin Log 及如何做到删库不跑路](https://yg-y.github.io/content.html?id=16)
- [MySQL 数据库日志文件之 Undo Log 让你了解 MySQL 事务](https://yg-y.github.io/content.html?id=20)
- [MySQL 语言：DDL/DML/DQL/DCL]()
- [MySQL 事务]()
- [MySQL 两大常用储存引擎：MyISAM/InnoDB]()
- [MySQL 集群方案及搭建]()
- [MySQL 分库分表实战]()

# 什么是 Undo Log

> undo log 又称 撤销日志、回滚日志，目的是用于撤销某个操作，回滚到某个状态

撤销日志是与单个读写事务关联的撤销日志记录的集合。撤消日志记录包含有关如何撤消事务对聚集索引记录的最新更改的信息。如果另一个事务需要将原始数据视为一致读操作的一部分，则从撤消日志记录检索未修改的数据。撤消日志存在于撤消日志段中，撤消日志段包含在回滚段中。回滚段驻留在系统表空间、撤销表空间和临时表空间中。

驻留在临时表空间中的撤消日志用于修改用户定义临时表中的数据的事务。这些撤销日志不会重做记录，因为它们不是崩溃恢复所需的。它们仅用于服务器运行时的回滚。这种类型的撤销日志可以避免重做日志 i/o，从而提高性能。

摘自 MySQL 官网

# 支持的并发事务量
> 事务在达到 InnoDB 能够支持的并发读写事务数量之前可能会遇到并发事务限制错误。当分配给事务的回滚段的撤消槽用完时，就会发生这种情况。在这种情况下，请尝试重新运行事务。

InnoDB 最多支持128个回滚段，其中32个回滚段分配给临时表空间。这样就剩下了96个回滚段，这些回滚段可以分配给修改常规表中数据的事务。InnoDB _ rollback _ segments 变量定义 InnoDB
使用的回滚段数量。

回滚段支持的事务数量取决于回滚段中的撤销槽数量和每个事务所需的撤销日志数量。

回滚段中撤销槽的数量根据 InnoDB 页面大小而不同。

|InnoDB Page Size |回滚段中撤销槽的数量 = (InnoDB Page Size/16)|
|---|---|
|4096 (4KB)|    256|
|8192 (8KB)    |512
|16384 (16KB)|    1024
|32768 (32KB)|    2048
|65536 (64KB)|    4096



