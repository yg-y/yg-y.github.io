# 基于 HotSpot 的 JAVA 虚拟机参数概览

> 记录在 JVM 启动参数设置时需要调整的一些参数，使其符合各类服务的运行环境，此文章以 JDK1.8 HotSpot 虚拟机为例
> 展示对应的虚拟器参数，不同版本的 JDK 及不同版本的虚拟器，参数或多或少会有区别，请以官方文档为准。

## 堆内存
> 堆内存是 JAVA 虚拟器 GC 操作最频繁的一块内存区域，也是 JAVA 虚拟机所管理的内存中最大的一块，
> JAVA 虚拟机堆是所有线程共享的一块内存区域，在虚拟机启动时创建。此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例以及数组都在这里分配内存。

### 默认堆大小

>如果没有指定堆大小，则会根据计算机的内存量来计算，默认的最大堆大小是物理内存的一半，最大物理内存为192兆字节(MB) ，
其他情况下是物理内存的四分之一，最大物理内存为 1 GB。
>
>例如，如果您的计算机有128 MB 的物理内存，那么最大堆大小为64 MB，大于或等于1 GB 的物理内存将导致最大堆大小为256 MB。
>
> 摘自 Oracle 官网

- 参数
    - heap size 表示要初始化内存的具体大小。
    - unit 表示要初始化内存的单位。单位为g、m、k。
```yaml
-Xms<heap size>[unit] 
-Xmx<heap size>[unit]
```
### 指定堆内存
- 指定最小堆内存
```yaml
-Xms2g
```  

- 指定最大堆内存
```yaml
-Xmx5g
```


### 指定堆内存中新生代大小 ( Young Generation )
> 除了总的可用内存之外，影响垃圾收集性能的第二个最重要的因素是专用于新生代的堆的比例。新生代内存越多，minor GC 就越少。
> 然而，对于有限的堆大小，较大的新生代空间意味着较老的一代空间越少，这将增加 major GC 的频率。
> 最佳选择取决于应用程序分配的对象的生命周期分布。

- 指定堆内存中新生代大小 —— 默认方式

> 默认情况下，新生代的大小由参数 NewRatio 控制。例如，设置 -XX: NewRatio = 3 意味着新生代和老年代之间的比率为1:3。换句话说，eden 和 survivor 空间的总和将是堆总大小的四分之一。

```yaml
-XX: NewRatio = 3
```

- 指定堆内存中新生代大小 —— 固定大小

> NewSize 和 MaxNewSize 从参数上限定了新生代的大小。

- 指定最小值
```yaml
-XX:NewSize=256m
```

- 指定最大值
```yaml
-XX:MaxNewSize=1024m

// 此设置表示新生代大小无限制
-XX:MaxNewSize=not limited
```

- 若要将堆中新生代大小设置成固定值
```yaml
-Xmn256m 
```

#### Oracle 官方给出堆新生代大小设置建议
- 首先确定给虚拟机提供的最大堆大小。然后根据新生代的大小来计算你的性能指标，以找到最佳的设置。
  - 请注意，最大堆大小应该始终小于安装在计算机上的内存量，以避免出现过多的页面错误和抖动。
- 如果总堆大小是固定的，那么增加新生代的大小就需要减小老年代的大小。保持老年代足够大，以容纳应用程序在任何给定时间使用的所有实时数据，再加上一定数量的闲置空间(10% 至20% 或更多)。
- 给予新生代足够的内存。
- 随着处理器数量的增加，增加年轻一代的大小，因为分配可以并行化。

### 指定永久代/元空间的大小
> JDK 1.8 的时候，方法区（HotSpot 的永久代）被彻底移除了（JDK1.7 就已经开始了），取而代之是元空间，元空间使用的是本地内存。

- 设置 Metaspace 的初始（和最小大小）
```yaml
-XX:MetaspaceSize=256m
```

- 设置 Metaspace 的最大大小，如果不指定大小的话，随着更多类的创建，虚拟机会耗尽所有可用的系统内存。
```yaml
-XX:MaxMetaspaceSize=512m
```






















